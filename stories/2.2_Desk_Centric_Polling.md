# Story 2.2: Desk-Centric Polling for Hand Raises

**Epic:** 2 - Perception & Sensing

**Description:**
Implement the desk-centric polling strategy to identify which desks have students requesting paper collection. The robot will systematically turn to face each desk and use the existing gesture detection to check for raised hands.

See `docs/DESK_CENTRIC_POLLING.md` for detailed strategy documentation.

**Tasks:**
1. Add `scan_angle` property to desk configuration (from Story 1.1)
   - Each desk needs an angle the robot should turn to for scanning
2. Create a new module: `yahoo/mission/polling.py`
3. Implement `DeskPoller` class with:
   - `scan_all_desks()` - Main polling routine
   - `scan_desk(desk_id)` - Turn to desk, check for raised hand
   - Returns list of desk IDs with raised hands (collection queue)
4. Scanning routine should:
   - Start from origin/polling position
   - Reset to known heading (0°)
   - For each desk:
     - Turn to desk's scan_angle
     - Wait for camera stabilization (0.5s)
     - Capture frame and run gesture detection
     - If hand raised: add to queue, log the request
   - Return to original heading
5. Experimentally determine optimal scan angles:
   - Set up test desks in a row
   - Have person raise hand at each desk
   - Test different robot positions and angles
   - Record angles that reliably center each desk in frame
   - Update configuration with working angles
6. Create test script: `tests/test_polling.py`
7. Add LED feedback when hand detected (green blink)

**Acceptance Criteria:**
- A `yahoo/mission/polling.py` module exists with `DeskPoller` class
- Configuration includes scan angles for each desk
- Robot can systematically scan all desks in sequence
- When a student raises hand while robot faces their desk, it's added to queue
- Scan of 4 desks completes in < 30 seconds
- System correctly identifies which desk has raised hand (no ambiguity)
- Test script demonstrates:
  - Single desk detection works
  - Multiple desks (one at a time) detected correctly
  - Empty desks (no hands) don't trigger false positives
- LED provides visual feedback when hand detected

**Design Considerations:**
- **Student protocol:** Only one student raises hand at a time
- **Timing:** Brief pause after turn for camera to stabilize
- **Robustness:** If gesture detection fails, log and continue to next desk
- **Queue management:** Store desk IDs in order detected
- **Visual feedback:** LED blink confirms detection to student

**Experimental Testing:**
Create a test checklist for finding optimal angles:
```
[ ] Set up 4 desks in a row (30cm spacing)
[ ] Position robot at origin
[ ] For each desk:
    [ ] Have student raise hand
    [ ] Test robot turning to different angles (80-100°)
    [ ] Record angle where desk is centered in camera view
    [ ] Verify gesture detection works reliably
    [ ] Document working angle in config
[ ] Test full sequence of all desks
[ ] Verify no cross-detection (wrong desk)
```

**Integration Points:**
- Uses `GestureDetector` from `yahoo/sense/gesture.py`
- Uses `Drive.turn_degrees()` for positioning
- Uses `LEDController` for feedback
- Loads desk configuration from Story 1.1
- Will be called by collection mission (Story 3.2)

**Success Metrics:**
- Detection accuracy: > 95% (detects raised hand when pointed at correct desk)
- False positive rate: < 5% (doesn't detect hands at other desks)
- No cross-desk confusion (always identifies correct desk)
